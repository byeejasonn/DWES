FROM php:8.1-rc-apache

# variables para crear usuarios y dar permisos a los programas
ARG uid = 1000
ARG user = byeejasonn

RUN apt update && apt install -y \
    php \
    git \
    curl \
    less \
    zip \
    nano \
    vim \
    php5-mysql

# instalacion modulos php
RUN docker-php-ext-install pdo pdo_mysql mysqli mbstring exif pcntl bcmath gd && docker-php-ext-enable pdo pdo_mysql

# creacion de usuario para correr composer
RUN useradd -G www-data, root -u $uid -d /home/$user $user

# damos permisos al usuario a todo la carpeta de composer
RUN mkdir -p /home/$user/.composer && \
    chown -R $user:$user /home/$user


# instalacion de composer
COPY --from:composer:2.5.1 /usr/bin/composer /usr/bin/composer

RUN cd /var/www ; \
    composer install ; \
    composer require vlucas/phpdotenv ; \
    composer require phpmailer/phpmailer ; \
    # php -c /etc/php/

WORKDIR /var/www

# ??
USER $user 